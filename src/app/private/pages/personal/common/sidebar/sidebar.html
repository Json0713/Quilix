<aside class="sidebar" [class.collapsed]="isCollapsed()" [class.mobile-open]="isMobileOpen()">
    <div class="sidebar-header">
        @if (!isCollapsed()) {
        <a class="logo-container" [routerLink]="['./']" (click)="toggleSidebar()" title="Quilix">
            <i class="bi bi-feather logo-icon"></i>
            <span class="logo-text">Quilix</span>
        </a>
        }
        <button class="toggle-btn" (click)="toggleSidebar()" [class.centered]="isCollapsed()"
            [title]="isCollapsed() ? 'Expand' : 'Close'">
            <i class="bi" [class.bi-layout-sidebar-inset]="!isCollapsed()"
                [class.bi-layout-sidebar]="isCollapsed()"></i>
        </button>
    </div>

    <nav class="sidebar-nav">
        <ul class="nav-list main-nav">
            @for (item of navItems; track item.label) {
            <li class="nav-item">
                <a [routerLink]="item.route" routerLinkActive="active"
                    [routerLinkActiveOptions]="{ exact: item.route === './' }" class="nav-link" [title]="item.label"
                    (click)="onItemClick()">
                    <i [class]="item.icon" class="nav-icon"></i>
                    @if (!isCollapsed()) {
                    <span class="nav-label">{{ item.label }}</span>
                    }
                </a>
            </li>
            }
        </ul>

        <!-- MySpace section (only when workspace is active) -->
        @if (activeWorkspace()) {
        <div class="nav-section spaces-section">
            @if (!isCollapsed()) {
            <div class="section-title">MySpace</div>
            } @else {
            <div class="section-divider"></div>
            }

            <!-- + New nav button -->
            <ul class="nav-list">
                <li class="nav-item">
                    <button class="nav-link new-space-nav" (click)="startCreating()" title="New space">
                        <i class="bi bi-plus-lg nav-icon"></i>
                        @if (!isCollapsed()) {
                        <span class="nav-label">New</span>
                        }
                    </button>
                </li>
            </ul>

            <!-- Inline create input -->
            @if (isCreating() && !isCollapsed()) {
            <div class="space-create-inline">
                <i class="bi bi-folder-plus create-icon"></i>
                <input #spaceInput type="text" class="space-name-input" placeholder="New space" [value]="newSpaceName()"
                    (input)="newSpaceName.set($any($event.target).value)" (keydown)="onSpaceInputKeydown($event)"
                    (blur)="confirmCreate()" maxlength="50" />
            </div>
            }

            <!-- Space list -->
            <ul class="nav-list space-list">
                @for (space of spaces(); track space.id) {
                <li class="nav-item space-item" [class.menu-open]="openMenuId() === space.id">
                    <a class="nav-link space-link" [title]="space.name" (click)="onItemClick()">
                        <i class="bi bi-folder nav-icon"></i>
                        @if (!isCollapsed()) {
                        <span class="nav-label">{{ space.name }}</span>
                        }
                    </a>

                    <!-- 3-dot menu (only expanded mode) -->
                    @if (!isCollapsed()) {
                    <button class="space-menu-trigger" (click)="toggleMenu(space.id, $event)" title="Options">
                        <i class="bi bi-three-dots-vertical"></i>
                    </button>

                    @if (openMenuId() === space.id) {
                    <div class="space-menu-dropdown">
                        <button class="dropdown-item delete-item" (click)="deleteSpace(space.id, $event)">
                            <i class="bi bi-trash3"></i>
                            <span>Delete</span>
                        </button>
                    </div>
                    }
                    }
                </li>
                }
            </ul>
        </div>
        }

        <!-- System section (pre-footer) -->
        <div class="nav-section system-nav">
            @if (!isCollapsed()) {
            <div class="section-title">System</div>
            } @else {
            <div class="section-divider"></div>
            }
            <ul class="nav-list">
                <li class="nav-item">
                    <a routerLink="./trash" routerLinkActive="active" class="nav-link" title="Trash"
                        (click)="onItemClick()">
                        <i class="bi bi-trash3 nav-icon"></i>
                        @if (!isCollapsed()) {
                        <span class="nav-label">Trash</span>
                        }
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="sidebar-footer">
        <div class="profile-section">
            <i class="bi bi-person-circle profile-icon"></i>
            @if (!isCollapsed()) {
            <div class="profile-info">
                <span class="profile-name">Jason O. Bayaga</span>
                <span class="profile-role">IQA Officer</span>
            </div>
            }
        </div>

        <app-personal-settings-kit />
    </div>
</aside>