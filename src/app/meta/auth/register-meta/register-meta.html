<div class="register-split-container">

  <!-- Left Side: Registration Form -->
  <div class="register-form-side">
    <div class="register-card">

      <!-- Brand Header -->
      <div class="brand-header">
        <a routerLink="/meta" class="brand-logo" title="Quilix Home">
          <i class="bi bi-feather"></i>
          <span>Quilix</span>
        </a>
        <a routerLink="/meta/login" class="home-link" title="Back to Login">
          <i class="bi bi-chevron-left"></i>
        </a>
      </div>

      <h1>Create account</h1>
      <p class="subtitle">Join our open social workspace and start building together.</p>

      @if (error) {
      <div class="error-banner">
        {{ error }}
      </div>
      }

      <form [formGroup]="registerForm" (ngSubmit)="submit()">

        <!-- Username -->
        <div class="form-group">
          <label for="username">Username</label>
          <input id="username" type="text" formControlName="username" placeholder="Enter Username"
            autocomplete="username" [class.invalid]="f['username'].invalid && f['username'].touched" />
          @if (f['username'].invalid && f['username'].touched) {
          <small class="error-text">Username is required (min 3 chars)</small>
          }
        </div>

        <!-- Email -->
        <div class="form-group">
          <label for="email">Email</label>
          <input id="email" type="email" formControlName="email" placeholder="your.name@example.com"
            autocomplete="email" [class.invalid]="f['email'].invalid && f['email'].touched" />
          @if (f['email'].invalid && f['email'].touched) {
          <small class="error-text">Valid email is required</small>
          }
        </div>

        <!-- Password -->
        <div class="form-group">
          <label for="password">Password</label>
          <div class="password-input-wrapper">
            <input [id]="'password'" [type]="showPassword ? 'text' : 'password'" formControlName="password"
              placeholder="Enter Password" autocomplete="new-password"
              [class.invalid]="f['password'].invalid && f['password'].touched" />
            <button type="button" class="password-toggle" (click)="showPassword = !showPassword"
              [title]="showPassword ? 'Hide password' : 'Show password'">
              <i class="bi" [class.bi-eye]="!showPassword" [class.bi-eye-slash]="showPassword"></i>
            </button>
          </div>
          @if (f['password'].invalid && f['password'].touched) {
          <small class="error-text">Password must be at least 8 characters</small>
          }
        </div>

        <!-- Confirm Password -->
        <div class="form-group">
          <label for="confirmPassword">Confirm Password</label>
          <div class="password-input-wrapper">
            <input [id]="'confirmPassword'" [type]="showConfirmPassword ? 'text' : 'password'"
              formControlName="confirmPassword" placeholder="Enter Confirm Password" autocomplete="new-password"
              [class.invalid]="(f['confirmPassword'].invalid || registerForm.hasError('mismatch')) && f['confirmPassword'].touched" />
            <button type="button" class="password-toggle" (click)="showConfirmPassword = !showConfirmPassword"
              [title]="showConfirmPassword ? 'Hide password' : 'Show password'">
              <i class="bi" [class.bi-eye]="!showConfirmPassword" [class.bi-eye-slash]="showConfirmPassword"></i>
            </button>
          </div>
          @if (registerForm.hasError('mismatch') && f['confirmPassword'].touched) {
          <small class="error-text">Passwords do not match</small>
          }
        </div>

        <!-- Progress Indicator -->
        <div class="progress-section">
          <div class="progress-track">
            <div class="progress-bar" [style.width.%]="progress" [style.background-color]="progressColor"></div>
          </div>
        </div>

        <!-- Phone -->
        <div class="form-group">
          <label for="phone">
            Phone <span class="optional">(Optional)</span>
          </label>

          <div class="phone-input-group phone-input-group--combined">
            <div class="select-wrapper">
              <select formControlName="countryCode">
                @for (country of countryCodes; track country.code) {
                <option [value]="country.code">
                  {{ country.label }} {{ country.code }}
                </option>
                }
              </select>
            </div>

            <input id="phone" type="tel" formControlName="phone" (input)="onPhoneInput($event)"
              [placeholder]="f['countryCode'].value === '+63' ? 'Phone Number' : 'Phone Number'" autocomplete="tel"
              [class.invalid]="f['phone'].invalid && f['phone'].touched" />
          </div>

          @if (f['phone'].hasError('invalidPhPhone') && f['phone'].touched) {
          <small class="error-text">
            Invalid PH number. Format: 9123456789 or 09123456789
          </small>
          }
        </div>

        <!-- Role Selection -->
        <div class="form-group role-group">
          <label>Account Type</label>
          <div class="role-options">
            <label class="radio-card" [class.selected]="f['role'].value === 'personal'">
              <input type="radio" formControlName="role" value="personal">
              <span class="radio-label">Personal</span>
            </label>
            <label class="radio-card" [class.selected]="f['role'].value === 'team'">
              <input type="radio" formControlName="role" value="team">
              <span class="radio-label">Team</span>
            </label>
          </div>
        </div>

        <!-- Submit -->
        <button type="submit" class="submit-btn" [disabled]="registerForm.invalid || loading">
          @if (loading) {
          Creating...
          } @else {
          Create Account
          }
        </button>

        <p class="login-link">
          Already have an account? <a routerLink="/meta/login">Log in</a>
        </p>

      </form>
    </div>
  </div>

  <!-- Right Side: Reusable Visual Mockup -->
  <div class="register-visual-side">
    <app-login-mockup></app-login-mockup>
  </div>

</div>