<section class="login-wrapper">

  <app-header></app-header>

  <!-- ONE UNIFIED CARD -->
  <article class="auth-card">

    <!-- LEFT : CREATE / LOGIN -->
    <section
      class="auth-section auth-primary"
      role="form"
      aria-labelledby="login-title"
    >

    <header class="create-header">
      <h2>Create Workspaces</h2>
      <p>Start your workspace</p>
    </header>

      <form
        class="auth-form"
        (ngSubmit)="createWorkspace()"
        novalidate
      >

        <!-- NAME -->
        <div class="field">
          <label for="name">Workspace name</label>
          <input
            id="name"
            type="text"
            name="name"
            placeholder="Enter your name"
            [(ngModel)]="name"
            required
            minlength="2"
            maxlength="20"
            autocomplete="off"
            [class.invalid]="errorMessage"
          />

          @if (errorMessage) {
            <p class="error-text">{{ errorMessage }}</p>
          }
        </div>

        <!-- ROLE -->
        <div class="field">
          <label>Role</label>

          <div class="role-select">
            <button
              type="button"
              class="role-btn"
              [class.active]="role === 'student'"
              (click)="role = 'student'"
              aria-pressed="{{ role === 'student' }}"
            >
              <i class="bi bi-mortarboard"></i>
              <span>Student</span>
            </button>

            <button
              type="button"
              class="role-btn"
              [class.active]="role === 'teacher'"
              (click)="role = 'teacher'"
              aria-pressed="{{ role === 'teacher' }}"
            >
              <i class="bi bi-person-badge"></i>
              <span>Teacher</span>
            </button>
          </div>
        </div>

        <!-- ACTION -->
        <button
          type="submit"
          class="primary-action"
          [disabled]="name.trim().length < 2 || !role || isSubmitting"
          aria-busy="{{ isSubmitting }}"
        >
          @if (isSubmitting) {
            <app-spinner [size]="18"></app-spinner>
          } @else {
            <span>Start Workspace</span>
            <i class="bi bi-arrow-right"></i>
          }
        </button>

      </form>

      <footer class="auth-footer">
        <small>Stay Focus · Feel Free · Manage Easy</small>
      </footer>

    </section>

    <!-- RIGHT : RECENT WORKSPACES -->
    <aside class="auth-section auth-secondary">

      <header class="recent-header">
        <h2>Recent Workspaces</h2>
        <p>Select a workspace to continue</p>
      </header>

      <!-- INITIAL LOADING -->
      @if (loading) {
        <div class="recent-loading" aria-busy="true">
          <app-spinner [size]="28"></app-spinner>
          <p>Preparing your workspaces…</p>
        </div>
      }

      @else {

        <!-- EMPTY -->
        @if (users.length === 0) {
          <div class="recent-empty">
            <i class="bi bi-clock-history"></i>
            <p>No recent workspaces</p>
            <small>Create one to get started</small>
          </div>
        }

        <!-- LIST -->
        @if (users.length > 0) {
          <ul class="user-list" role="list">

            @for (user of users; track user.id) {

              <li
                class="user-card"
                [class.confirm]="deletingUserId === user.id"
              >

                <!-- NORMAL -->
                @if (deletingUserId !== user.id) {

                  <div
                    class="user-info"
                    role="button"
                    tabindex="0"
                    (click)="continueWorkspace(user)"
                    [attr.aria-busy]="loadingUserId === user.id"
                  >

                    <div
                      class="avatar"
                      [style.background]="getAvatarColor(user.id)"
                      aria-hidden="true"
                    >
                      <i
                        class="bi"
                        [class.bi-mortarboard]="user.role === 'student'"
                        [class.bi-person-badge]="user.role === 'teacher'"
                      ></i>
                    </div>

                    <div class="user-meta">
                      <strong>{{ user.name }}</strong>
                      <small>
                        {{ user.role === 'student' ? 'Student' : 'Teacher' }}
                        · {{ user.lastActiveAt | date:'short' }}
                      </small>
                    </div>

                    @if (loadingUserId === user.id) {
                      <app-spinner [size]="16"></app-spinner>
                    }
                  </div>

                  <button
                    type="button"
                    class="delete-btn"
                    aria-label="Delete workspace"
                    (click)="requestDelete(user); $event.stopPropagation()"
                  >
                    <i class="bi bi-x-diamond"></i>
                  </button>

                }

                <!-- CONFIRM DELETE -->
                @else {
                  <div class="confirm-delete">
                    <p>Delete this workspace?</p>

                    <div class="confirm-actions">
                      <button
                        type="button"
                        class="danger"
                        (click)="confirmDelete(user)"
                      >
                        @if (loadingUserId === user.id) {
                          <app-spinner [size]="14"></app-spinner>
                        } @else {
                          Delete
                        }
                      </button>

                      <button
                        type="button"
                        class="ghost"
                        (click)="cancelDelete()"
                      >
                        Cancel
                      </button>
                    </div>
                  </div>
                }

              </li>

            }

          </ul>
        }

      }

    </aside>

  </article>

  <div class="footer mt-3">
    <app-footer></app-footer>
  </div>

</section>
