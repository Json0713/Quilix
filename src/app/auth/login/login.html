<section class="login-wrapper">

  <!-- ONE UNIFIED CARD -->
  <article class="auth-card">
    <!-- LEFT : CREATE / LOGIN -->
    <section
      class="auth-section auth-primary"
      role="form"
      aria-labelledby="login-title"
    >

      <div class="header-title" title="Quilix">
        <div class="brand-icon" routerLink="/" aria-label="Go to homepage">
          <i class="bi bi-feather"></i>
            Quilix
        </div>
        <p class="brand-subtitle">
          Startup your day with a cup of coffee.
        </p>
      </div>

      <form
        class="auth-form"
        (ngSubmit)="createWorkspace()"
        novalidate
      >

        <!-- Name -->
        <div class="field"> 
          <label for="name">Workspace</label>
          <input
            id="name"
            type="text"
            name="name"
            placeholder="Enter Workspace Name"
            [(ngModel)]="name"
            required
            minlength="2"
            maxlength="100"
            autocomplete="off"
            [class.invalid]="errorMessage"
          />
          @if (errorMessage) {
            <p class="error-text">{{ errorMessage }}</p>
          }
        </div>

        <!-- Role -->
        <div class="field">
          <label>I am</label>

          <div class="role-select">
            <button
              type="button"
              class="role-btn"
              [class.active]="role === 'student'"
              (click)="role = 'student'"
              aria-pressed="{{ role === 'student' }}"
            >
              <i class="bi bi-mortarboard"></i>
              <span>Student</span>
            </button>

            <button
              type="button"
              class="role-btn"
              [class.active]="role === 'teacher'"
              (click)="role = 'teacher'"
              aria-pressed="{{ role === 'teacher' }}"
            >
              <i class="bi bi-person-workspace"></i>
              <span>Teacher</span>
            </button>
          </div>
        </div>

        <!-- Action -->
        <button
          type="submit"
          class="primary-action"
          [disabled]="name.trim().length < 2 || !role || isSubmitting"
          aria-busy="{{ isSubmitting }}"
        >
          @if (isSubmitting) {
            <app-spinner [size]="18"></app-spinner>
          } @else {
            <span>Start Workspace</span>
          }
        </button>

      </form>

      <footer class="auth-footer">
        <small>Stay Focus · Feel Free · Manage Easy</small>
      </footer>

    </section>

    <!-- RIGHT : RECENT WORKSPACES -->
    <aside class="auth-section auth-secondary">

    <header class="recent-header">
      <div class="recent-header-text">
        <h2>Recent Workspaces</h2>
        <p>Select a workspace to continue</p>
      </div>

      <button
        type="button"
        class="btn secondary import-trigger"
        (click)="openImport()"
        aria-label="Import backup"
      >
        <i class="bi bi-cloud-arrow-down"></i>
        Import
      </button>
    </header>

      <!-- INITIAL LOADING -->
      @if (loading) {
        <div class="recent-loading" aria-busy="true">
          <app-spinner [size]="28" class="mb-4"/>
          <p>Preparing your workspaces…</p>
        </div>
      }

      @else {

        <!-- Empty -->
        @if (users.length === 0) {
          <div class="recent-empty">
            <i class="bi bi-clock-history"></i>
            <p>No recent workspaces</p>
            <small>Create one to get started</small>
          </div>
        }

        <!-- List -->
        @if (users.length > 0) {
          <ul class="user-list" role="list">

            @for (user of users; track user.id) {

              <li
                class="user-card"
                [class.confirm]="deletingUserId === user.id"
              >

                <!-- Normal -->
                @if (deletingUserId !== user.id) {

                  <div
                    class="user-info"
                    role="button"
                    tabindex="0"
                    (click)="continueWorkspace(user)"
                    [attr.aria-busy]="loadingUserId === user.id"
                  >

                    <div
                      class="avatar"
                      [style.background]="getAvatarColor(user.id)"
                      aria-hidden="true"
                    >
                      <i
                        class="bi"
                        [class.bi-mortarboard]="user.role === 'student'"
                        [class.bi-person-workspace]="user.role === 'teacher'"
                      ></i>
                    </div>

                    <div class="user-meta">
                      <strong>{{ user.name }}</strong>
                      <small>
                        {{ user.role === 'student' ? 'Student' : 'Teacher' }}
                        · {{ user.lastActiveAt | timeAgo }}
                      </small>
                    </div>

                    @if (loadingUserId === user.id) {
                      <div class="user-info-spinner" aria-hidden="true">
                        <app-spinner [size]="24"></app-spinner>
                      </div>
                    }
                  </div>

                  <button
                    type="button"
                    class="delete-icon"
                    aria-label="Delete workspace"
                    (click)="requestDelete(user); $event.stopPropagation()"
                  >
                    <i class="bi bi-x-diamond"></i>
                  </button>

                }

                <!-- Confirm Delete -->
                @else {
                  <div class="confirm-delete">
                    <p>Delete this workspace?</p>

                    <div class="confirm-actions">
                      <button
                        type="button"
                        class="danger"
                        (click)="confirmDelete(user)"
                      >
                        @if (loadingUserId === user.id) {
                          <app-spinner class="px-2" [size]="14"></app-spinner>
                        } @else {
                          Delete
                        }
                      </button>

                      <button
                        type="button"
                        class="ghost"
                        (click)="cancelDelete()"
                      >
                        Cancel
                      </button>
                    </div>
                  </div>
                }

              </li>

            }

          </ul>
        }

      }

      <footer class="footer">
        <p class="description">
          • Plan tasks • Organize projects • Academic workflows <br/>
          • A focused, workspace built for modern learning.
        </p>
      </footer>

    </aside>
  </article>

</section>
