<div class="trash-container">
    <div class="trash-header">
        <div class="header-text">
            <h2>Trash</h2>
            <p>Items in trash are automatically deleted forever after 30 days.</p>
        </div>

        @if (!isLoading() && trashedWorkspaces().length > 0) {
        <button class="select-toggle-btn" (click)="toggleSelectionMode()" [class.active]="selectionMode()">
            @if (selectionMode()) {
            <i class="bi bi-x-lg"></i>
            <span>Cancel</span>
            } @else {
            <i class="bi bi-check2-square"></i>
            <span>Select</span>
            }
        </button>
        }
    </div>

    <!-- Selection toolbar -->
    @if (selectionMode()) {
    <div class="selection-toolbar">
        <div class="toolbar-left">
            <button class="toolbar-btn checkbox-btn" (click)="toggleSelectAll()" [class.checked]="isAllSelected()">
                <i class="bi" [class.bi-check-square-fill]="isAllSelected()" [class.bi-square]="!isAllSelected()"></i>
            </button>
            <span class="selection-count">
                {{ selectedCount() }} selected
            </span>
        </div>

        <div class="toolbar-actions">
            @if (confirmingBulkDelete()) {
            <div class="bulk-confirm">
                <span class="confirm-label">Delete {{ selectedCount() }} permanently?</span>
                <button class="toolbar-btn confirm-yes" (click)="confirmBulkDelete()" [disabled]="isBulkProcessing()">
                    @if (isBulkProcessing()) {
                    <i class="bi bi-arrow-repeat spin"></i>
                    } @else {
                    Yes
                    }
                </button>
                <button class="toolbar-btn confirm-no" (click)="cancelBulkDelete()"
                    [disabled]="isBulkProcessing()">No</button>
            </div>
            } @else {
            <button class="toolbar-btn restore-action" (click)="bulkRestore()"
                [disabled]="selectedCount() === 0 || isBulkProcessing()">
                @if (isBulkProcessing()) {
                <i class="bi bi-arrow-repeat spin"></i>
                } @else {
                <i class="bi bi-arrow-counterclockwise"></i>
                }
                <span class="btn-label">Restore</span>
            </button>
            <button class="toolbar-btn delete-action" (click)="requestBulkDelete()" [disabled]="selectedCount() === 0">
                <i class="bi bi-trash"></i>
                <span class="btn-label">Delete</span>
            </button>
            }
        </div>
    </div>
    }

    @if (isLoading()) {
    <div class="loading-state">
        <i class="bi bi-arrow-repeat spin"></i>
        <span>Loading...</span>
    </div>
    } @else if (trashedWorkspaces().length === 0) {
    <div class="empty-state">
        <i class="bi bi-trash3"></i>
        <p>Your trash is empty.</p>
    </div>
    } @else {
    <div class="workspace-list">
        @for (ws of trashedWorkspaces(); track ws.id) {
        <div class="workspace-card" [class.processing]="processingId() === ws.id" [class.selected]="isSelected(ws.id)"
            [class.in-select-mode]="selectionMode()" (click)="selectionMode() ? toggleSelect(ws.id) : null">

            <!-- Selection checkbox (square) -->
            @if (selectionMode()) {
            <div class="card-checkbox" (click)="$event.stopPropagation(); toggleSelect(ws.id)">
                <i class="bi" [class.bi-check-square-fill]="isSelected(ws.id)"
                    [class.bi-square]="!isSelected(ws.id)"></i>
            </div>
            }

            <div class="card-info">
                <div class="icon-wrapper">
                    <i class="bi" [class.bi-person-workspace]="ws.role === 'personal'"
                        [class.bi-people]="ws.role === 'team'">
                    </i>
                </div>
                <div class="details">
                    <h3>{{ ws.name }}</h3>
                    <span class="role-badge" [class.team]="ws.role === 'team'">
                        {{ ws.role | titlecase }}
                    </span>
                    <span class="time-info">
                        Trashed {{ ws.trashedAt | timeAgo }} â€¢ {{ getDaysLeft(ws.trashedAt) }}
                    </span>
                </div>
            </div>

            @if (!selectionMode()) {
            <div class="card-actions">
                @if (confirmingDeleteId() === ws.id) {
                <div class="confirm-overlay">
                    <span>Delete permanently?</span>
                    <button class="btn btn-sm btn-danger" (click)="confirmDelete(ws.id)"
                        [disabled]="processingId() === ws.id">Yes</button>
                    <button class="btn btn-sm btn-outline-secondary" (click)="cancelDelete()"
                        [disabled]="processingId() === ws.id">No</button>
                </div>
                } @else {
                <button class="btn btn-outline-primary restore-btn" (click)="restoreWorkspace(ws.id)"
                    [disabled]="processingId() === ws.id" title="Restore">
                    <i class="bi bi-arrow-counterclockwise"></i>
                </button>
                <button class="btn btn-outline-danger delete-btn" (click)="requestPermanentDelete(ws.id)"
                    [disabled]="processingId() === ws.id" title="Delete Permanently">
                    <i class="bi bi-trash"></i>
                </button>
                }
            </div>
            }
        </div>
        }
    </div>
    }
</div>